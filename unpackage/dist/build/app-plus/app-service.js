if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((s=>t.resolve(e()).then((()=>s))),(s=>t.resolve(e()).then((()=>{throw s}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...s){uni.__log__?uni.__log__(e,t,...s):console[e].apply(console,[...s,t])}const s=(e,t)=>{const s=e.__vccOpts||e;for(const[o,a]of t)s[o]=a;return s};const o=s({data:()=>({orderStatus:"",socketOpen:!1,socketTask:null,streamUrl:"http://localhost:8085/hls/test.m3u8",websocketUrl:"ws://localhost:8080",selectedProduct:null,products:[{id:"P-1001",name:"光伏板",price:199,tag:"guangfu",image:"https://q4.itc.cn/images01/20241223/084b3f28c95647c896a31f81f15e5901.png"}]}),onLoad(){this.loadSettings()},onShow(){this.loadSettings(),this.connectIfReady()},onUnload(){this.closeSocket()},methods:{loadSettings(){const e=uni.getStorageSync("streamUrl"),t=uni.getStorageSync("websocketUrl");this.streamUrl=e||"http://localhost:8085/hls/test.m3u8",this.websocketUrl=t||"ws://localhost:8080"},connectIfReady(){this.streamUrl&&this.websocketUrl?(this.orderStatus="正在连接直播服务...",this.connectWebSocket()):this.orderStatus="请前往设置填写直播地址和 WebSocket"},connectWebSocket(){this.closeSocket();const e=this.websocketUrl,s=uni.connectSocket({url:e,success:()=>{t("log","at pages/index/index.vue:131","WebSocket连接发起成功")}});this.socketTask=s,s.onOpen((()=>{this.socketOpen=!0,this.orderStatus="已连接直播间，等待下单",t("log","at pages/index/index.vue:140","WebSocket已打开")})),s.onMessage((e=>{this.orderStatus=e.data})),s.onClose((()=>{this.socketOpen=!1,t("log","at pages/index/index.vue:149","WebSocket已关闭")})),s.onError((e=>{this.socketOpen=!1,this.orderStatus="连接出错，请检查地址后重试",t("error","at pages/index/index.vue:155","WebSocket连接出错",e)}))},openSettings(){uni.navigateTo({url:"/pages/settings/index"})},closeSocket(){this.socketTask&&(this.socketTask.close({code:1e3,reason:"reconnect"}),this.socketTask=null)},selectProduct(e){this.selectedProduct=e},placeOrder(){if(!this.selectedProduct)return void uni.showToast({title:"请先选择商品",icon:"none"});const e=`商品ID: ${this.selectedProduct.id}`;this.socketOpen&&this.socketTask?this.socketTask.send({data:e,success:()=>{this.orderStatus=`${this.selectedProduct.name} 下单成功，等待确认...`},fail:()=>{this.orderStatus="下单失败，请稍后重试"}}):this.orderStatus="连接未建立，无法下单"}}},[["render",function(t,s,o,a,l,c){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("view",{class:"header-left"},[e.createElementVNode("text",{class:"badge"},"LIVE"),e.createElementVNode("view",{class:"title-wrap"},[e.createElementVNode("text",{class:"title"},"智能装备赛道"),e.createElementVNode("text",{class:"subtitle"},"智能制造 · 即时下单")])]),e.createElementVNode("view",{class:"settings-entry",onClick:s[0]||(s[0]=(...e)=>c.openSettings&&c.openSettings(...e))},[e.createElementVNode("text",{class:"settings-icon"},"⚙️")])]),e.createElementVNode("view",{class:"player-card"},[e.createElementVNode("video",{id:"rtmpVideo",class:"player",src:l.streamUrl,controls:"",autoplay:"","enable-progress-gesture":!1,"object-fit":"contain"},null,8,["src"]),e.createElementVNode("view",{class:"live-info"},[e.createElementVNode("text",{class:"live-title"},"基于电商订单驱动的柔性智能制造系统"),e.createElementVNode("text",{class:"live-desc"},"第十八届山东省职业院校技能大赛")])]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"section-title"},[e.createElementVNode("text",{class:"dot"}),e.createElementVNode("text",null,"商品精选")]),e.createElementVNode("scroll-view",{class:"product-list","scroll-x":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.products,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:e.normalizeClass(["product-card",{active:l.selectedProduct&&l.selectedProduct.id===t.id}]),onClick:e=>c.selectProduct(t)},[e.createElementVNode("image",{class:"product-image",src:t.image,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"product-info"},[e.createElementVNode("text",{class:"product-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"product-tag"},e.toDisplayString(t.tag),1),e.createElementVNode("view",{class:"product-footer"},[e.createElementVNode("text",{class:"product-price"},"¥"+e.toDisplayString(t.price),1),e.createElementVNode("text",{class:"choose-text"},e.toDisplayString(l.selectedProduct&&l.selectedProduct.id===t.id?"已选":"选择"),1)])])],10,["onClick"])))),128))])]),e.createElementVNode("view",{class:"action-card"},[e.createElementVNode("view",null,[e.createElementVNode("text",{class:"action-title"},"下单中心"),e.createElementVNode("text",{class:"action-desc"}," 请选择心仪的商品并确认下单，订单状态会实时显示 ")]),e.createElementVNode("button",{class:"order-btn",type:"primary",onClick:s[1]||(s[1]=(...e)=>c.placeOrder&&c.placeOrder(...e))},e.toDisplayString(l.selectedProduct?`下单：${l.selectedProduct.name}`:"请选择商品后下单"),1)]),l.orderStatus?(e.openBlock(),e.createElementBlock("view",{key:0,class:"status-card"},[e.createElementVNode("view",{class:"status-title"},"订单状态"),e.createElementVNode("text",{class:"status-text"},e.toDisplayString(l.orderStatus),1)])):e.createCommentVNode("",!0)])}],["__scopeId","data-v-6e07e5df"]]),a="streamUrl",l="websocketUrl";const c=s({data:()=>({streamUrl:"",websocketUrl:""}),onLoad(){this.loadSettings()},methods:{loadSettings(){const e=uni.getStorageSync(a),t=uni.getStorageSync(l);this.streamUrl=e||"http://localhost:8085/hls/test.m3u8",this.websocketUrl=t||"ws://localhost:8080"},saveSettings(){this.streamUrl?this.websocketUrl?(uni.setStorageSync(a,this.streamUrl),uni.setStorageSync(l,this.websocketUrl),uni.showToast({title:"保存成功",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),300)):uni.showToast({title:"请填写 WebSocket 地址",icon:"none"}):uni.showToast({title:"请填写直播地址",icon:"none"})}}},[["render",function(t,s,o,a,l,c){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"badge"},"SETTINGS"),e.createElementVNode("view",{class:"title-wrap"},[e.createElementVNode("text",{class:"title"},"直播配置"),e.createElementVNode("text",{class:"subtitle"},"修改直播播放地址与 WebSocket 连接")])]),e.createElementVNode("view",{class:"settings-card"},[e.createElementVNode("view",{class:"form-field"},[e.createElementVNode("text",{class:"field-label"},"直播地址"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>l.streamUrl=e),class:"field-input",placeholder:"请输入直播流地址，如 http://...m3u8","placeholder-class":"field-placeholder"},null,512),[[e.vModelText,l.streamUrl,void 0,{trim:!0}]])]),e.createElementVNode("view",{class:"form-field"},[e.createElementVNode("text",{class:"field-label"},"WebSocket 地址"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>l.websocketUrl=e),class:"field-input",placeholder:"请输入 WebSocket 地址，如 ws://...","placeholder-class":"field-placeholder"},null,512),[[e.vModelText,l.websocketUrl,void 0,{trim:!0}]])]),e.createElementVNode("button",{class:"apply-btn",type:"primary",onClick:s[2]||(s[2]=(...e)=>c.saveSettings&&c.saveSettings(...e))}," 保存并返回 ")])])}],["__scopeId","data-v-775411f6"]]);__definePage("pages/index/index",o),__definePage("pages/settings/index",c);const r={onLaunch:function(){t("log","at App.vue:4","App Launch")},onShow:function(){t("log","at App.vue:7","App Show")},onHide:function(){t("log","at App.vue:10","App Hide")}};const{app:n,Vuex:i,Pinia:d}={app:e.createVueApp(r)};uni.Vuex=i,uni.Pinia=d,n.provide("__globalStyles",__uniConfig.styles),n._component.mpType="app",n._component.render=()=>{},n.mount("#app")}(Vue);
